<template>
  <div class="container-fluid">
    <!-- Header with title and actions -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="h3">User Management</h1>
      <button @click="showCreateModal = true" class="btn btn-primary">
        <i class="bi bi-plus-circle me-2"></i>Create User
      </button>
    </div>

    <!-- Search and filters -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <input 
              v-model="searchQuery" 
              type="text" 
              class="form-control" 
              placeholder="Search users..."
            >
          </div>
          <div class="col-md-3">
            <select v-model="filterRole" class="form-select">
              <option value="">All Roles</option>
              <option value="Admin">Admin</option>
              <option value="User">User</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- User list component -->
    <UserList 
      :users="filteredUsers" 
      :loading="loading"
      @edit="handleEdit"
      @delete="handleDelete"
    />

    <!-- Create/Edit modal -->
    <UserFormModal 
      v-if="showCreateModal"
      @close="showCreateModal = false"
      @save="handleSave"
    />
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue';
import UserList from './components/UserList.vue';
import UserFormModal from './components/UserFormModal.vue';

const users = ref([]);
const loading = ref(false);
const searchQuery = ref('');
const filterRole = ref('');
const showCreateModal = ref(false);

const filteredUsers = computed(() => {
  return users.value.filter(user => {
    const matchesSearch = user.email.toLowerCase().includes(searchQuery.value.toLowerCase());
    const matchesRole = !filterRole.value || user.roles.includes(filterRole.value);
    return matchesSearch && matchesRole;
  });
});

const fetchUsers = async () => {
  loading.value = true;
  try {
    const response = await fetch('/api/admin/users');
    users.value = await response.json();
  } catch (error) {
    console.error('Failed to fetch users:', error);
  } finally {
    loading.value = false;
  }
};

const handleEdit = (user) => {
  // Implementation
};

const handleDelete = async (userId) => {
  // Implementation
};

const handleSave = async (userData) => {
  // Implementation
  await fetchUsers();
  showCreateModal.value = false;
};

onMounted(() => {
  fetchUsers();
});
</script>
